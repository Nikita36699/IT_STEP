-- CREATE TABLE STUDENTS (
-- 	STUDENT_ID SERIAL PRIMARY KEY,
-- 	PIB VARCHAR(50),
-- 	CITY VARCHAR(25),
-- 	COUNTRY VARCHAR(20),
-- 	BIRTHDAY DATE,
-- 	EMAIL VARCHAR(40),
-- 	TELEPHONE VARCHAR(13),
-- 	GROUP_NAME VARCHAR(15),
-- 	AVG_GRADE INT,
-- 	MIN_SUBJECT_NAME VARCHAR(20),
-- 	MIN_SUBJECT_GRADE INT,
-- 	MAX_SUBJECT_NAME VARCHAR(20),
-- 	MAX_SUBJECT_GRADE INT
-- );


-- INSERT INTO STUDENTS (
--     PIB, CITY, COUNTRY, BIRTHDAY, EMAIL, TELEPHONE, GROUP_NAME,
--     AVG_GRADE, MIN_SUBJECT_NAME, MIN_SUBJECT_GRADE,
--     MAX_SUBJECT_NAME, MAX_SUBJECT_GRADE
-- )
-- VALUES
-- ('Іваненко Іван Іванович', 'Київ', 'Україна', '2003-05-14', 'ivanenko1@gmail.com', '+380501111111', 'ІТ-21', 85, 'Математика', 70, 'Програмування', 95),
-- ('Петренко Марія Сергіївна', 'Львів', 'Україна', '2002-09-22', 'petrenko.m@gmail.com', '+380501111112', 'ІТ-21', 90, 'Фізика', 80, 'Алгоритми', 98),
-- ('Сидоренко Олег Петрович', 'Одеса', 'Україна', '2004-01-30', 'sydorenko.o@gmail.com', '+380501111113', 'ІТ-22', 78, 'Історія', 60, 'Бази даних', 92),
-- ('Мельник Анастасія Ігорівна', 'Харків', 'Україна', '2003-07-18', 'melnyk.a@gmail.com', '+380501111114', 'ІТ-22', 88, 'Фізика', 75, 'Математика', 99),
-- ('Коваленко Андрій Васильович', 'Дніпро', 'Україна', '2003-03-25', 'kovalenko.andrii@gmail.com', '+380501111115', 'ІТ-21', 82, 'Філософія', 65, 'Програмування', 94),
-- ('Шевченко Оксана Петрівна', 'Чернівці', 'Україна', '2004-02-11', 'shevchenko.oksana@gmail.com', '+380501111116', 'ІТ-22', 91, 'Історія', 78, 'Програмування', 100),
-- ('Бондар Юрій Степанович', 'Полтава', 'Україна', '2003-06-09', 'bondar.yurii@gmail.com', '+380501111117', 'ІТ-23', 79, 'Фізика', 62, 'Алгоритми', 90),
-- ('Гуменюк Наталія Андріївна', 'Вінниця', 'Україна', '2002-11-28', 'humeniuk.n@gmail.com', '+380501111118', 'ІТ-23', 84, 'Хімія', 72, 'Математика', 93),
-- ('Данилюк Павло Михайлович', 'Житомир', 'Україна', '2003-12-02', 'danyliuk.p@gmail.com', '+380501111119', 'ІТ-21', 87, 'Історія', 76, 'Бази даних', 97),
-- ('Мороз Ольга Василівна', 'Кропивницький', 'Україна', '2004-04-15', 'moroz.olha@gmail.com', '+380501111120', 'ІТ-22', 89, 'Фізика', 80, 'Програмування', 98),
-- ('Романюк Ірина Олегівна', 'Луцьк', 'Україна', '2003-05-10', 'romaniuk.i@gmail.com', '+380501111121', 'ІТ-21', 77, 'Хімія', 64, 'Алгоритми', 88),
-- ('Мартинюк Дмитро Сергійович', 'Хмельницький', 'Україна', '2004-07-20', 'martyniuk.d@gmail.com', '+380501111122', 'ІТ-23', 80, 'Філософія', 70, 'Математика', 90),
-- ('Олійник Олена Володимирівна', 'Рівне', 'Україна', '2002-10-07', 'oliinyk.o@gmail.com', '+380501111123', 'ІТ-23', 86, 'Історія', 75, 'Програмування', 96),
-- ('Григоренко Максим Петрович', 'Чернігів', 'Україна', '2003-03-11', 'hryhorenko.m@gmail.com', '+380501111124', 'ІТ-22', 83, 'Фізика', 69, 'Бази даних', 92),
-- ('Лисенко Тетяна Олександрівна', 'Київ', 'Україна', '2003-08-17', 'lysenko.t@gmail.com', '+380501111125', 'ІТ-21', 88, 'Філософія', 77, 'Математика', 98),
-- ('Кравченко Ігор Ігорович', 'Львів', 'Україна', '2004-05-23', 'kravchenko.i@gmail.com', '+380501111126', 'ІТ-22', 79, 'Хімія', 65, 'Алгоритми', 90),
-- ('Ткачук Вікторія Вікторівна', 'Одеса', 'Україна', '2003-02-09', 'tkachuk.v@gmail.com', '+380501111127', 'ІТ-23', 91, 'Фізика', 82, 'Програмування', 99),
-- ('Савченко Денис Петрович', 'Харків', 'Україна', '2002-09-14', 'savchenko.d@gmail.com', '+380501111128', 'ІТ-21', 85, 'Філософія', 70, 'Математика', 95),
-- ('Руденко Олена Степанівна', 'Київ', 'Україна', '2003-11-01', 'rudenko.o@gmail.com', '+380501111129', 'ІТ-22', 82, 'Історія', 68, 'Бази даних', 91),
-- ('Поліщук Андрій Павлович', 'Львів', 'Україна', '2004-01-27', 'polishchuk.a@gmail.com', '+380501111130', 'ІТ-23', 89, 'Хімія', 74, 'Програмування', 97),
-- ('Захаренко Владислав Ігорович', 'Черкаси', 'Україна', '2003-05-06', 'zakharenko.v@gmail.com', '+380501111131', 'ІТ-21', 80, 'Фізика', 66, 'Математика', 91),
-- ('Тимошенко Софія Іванівна', 'Київ', 'Україна', '2004-07-19', 'tymoshenko.s@gmail.com', '+380501111132', 'ІТ-22', 92, 'Філософія', 79, 'Програмування', 100),
-- ('Дяченко Володимир Сергійович', 'Полтава', 'Україна', '2003-06-15', 'diachenko.v@gmail.com', '+380501111133', 'ІТ-23', 87, 'Історія', 76, 'Математика', 95),
-- ('Зінченко Катерина Андріївна', 'Одеса', 'Україна', '2002-08-28', 'zinchenko.k@gmail.com', '+380501111134', 'ІТ-21', 84, 'Фізика', 73, 'Алгоритми', 94),
-- ('Семенюк Анна Василівна', 'Дніпро', 'Україна', '2004-09-09', 'semeniuk.a@gmail.com', '+380501111135', 'ІТ-22', 90, 'Філософія', 82, 'Програмування', 99),
-- ('Мазур Богдан Ігорович', 'Київ', 'Україна', '2003-01-12', 'mazur.b@gmail.com', '+380501111136', 'ІТ-23', 83, 'Хімія', 70, 'Бази даних', 92),
-- ('Гончаренко Валерія Олександрівна', 'Львів', 'Україна', '2004-02-24', 'honcharenko.v@gmail.com', '+380501111137', 'ІТ-21', 86, 'Історія', 75, 'Програмування', 96),
-- ('Кушнір Артем Романович', 'Чернівці', 'Україна', '2003-03-17', 'kushnir.a@gmail.com', '+380501111138', 'ІТ-22', 79, 'Філософія', 66, 'Математика', 90),
-- ('Паламарчук Віктор Михайлович', 'Харків', 'Україна', '2002-12-03', 'palamarchuk.v@gmail.com', '+380501111139', 'ІТ-23', 88, 'Фізика', 77, 'Бази даних', 97),
-- ('Скорик Аліна Петрівна', 'Вінниця', 'Україна', '2003-07-11', 'skoryk.a@gmail.com', '+380501111140', 'ІТ-21', 81, 'Історія', 68, 'Алгоритми', 90),
-- ('Гаврилюк Олег Васильович', 'Київ', 'Україна', '2004-03-04', 'havryliuk.o@gmail.com', '+380501111141', 'ІТ-22', 84, 'Хімія', 71, 'Програмування', 94),
-- ('Білик Марія Олександрівна', 'Луцьк', 'Україна', '2002-10-21', 'bilyk.m@gmail.com', '+380501111142', 'ІТ-23', 90, 'Фізика', 80, 'Математика', 99),
-- ('Сергієнко Ілля Петрович', 'Київ', 'Україна', '2003-06-08', 'serhiienko.i@gmail.com', '+380501111143', 'ІТ-21', 85, 'Філософія', 72, 'Бази даних', 93),
-- ('Таран Наталя Сергіївна', 'Львів', 'Україна', '2003-09-19', 'taran.n@gmail.com', '+380501111144', 'ІТ-22', 89, 'Хімія', 77, 'Програмування', 97),
-- ('Павленко Олександр Андрійович', 'Одеса', 'Україна', '2004-01-16', 'pavlenko.o@gmail.com', '+380501111145', 'ІТ-23', 83, 'Філософія', 70, 'Математика', 92),
-- ('Черненко Світлана Василівна', 'Дніпро', 'Україна', '2003-11-29', 'cherneko.s@gmail.com', '+380501111146', 'ІТ-21', 86, 'Історія', 75, 'Бази даних', 95),
-- ('Остапенко Богдан Петрович', 'Харків', 'Україна', '2002-08-13', 'ostapenko.b@gmail.com', '+380501111147', 'ІТ-22', 80, 'Фізика', 68, 'Програмування', 91),
-- ('Миронюк Катерина Юріївна', 'Київ', 'Україна', '2004-05-01', 'myroniuk.k@gmail.com', '+380501111148', 'ІТ-23', 88, 'Філософія', 75, 'Математика', 97),
-- ('Литвин Артем Сергійович', 'Черкаси', 'Україна', '2003-12-08', 'lytvyn.a@gmail.com', '+380501111149', 'ІТ-21', 82, 'Історія', 70, 'Алгоритми', 92);

-- ALTER TABLE STUDENTS
-- ALTER COLUMN PIB TYPE VARCHAR(50);


-- -- Відображати всієї інформації з таблиці зі студентами
-- -- та оцінками.
-- -- Відображати ПІБ усіх студентів.


SELECT *
FROM STUDENTS;

-- SELECT PIB
-- FROM STUDENTS;
-- Завдання 1
-- Створіть наступні запити для бази даних з оцінками
-- студентів із попереднього практичного завдання:
-- ■ Показати ПІБ усіх студентів з мінімальною оцінкою
-- у вказаному діапазоні.
SELECT PIB, MIN_SUBJECT_GRADE
FROM STUDENTS 
WHERE MIN_SUBJECT_GRADE BETWEEN 60 AND 70; 



-- ■ Показати інформацію про студентів, яким виповни-
-- лося 22 років.
SELECT PIB, BIRTHDAY, EXTRACT(YEAR FROM AGE(BIRTHDAY)) AS FULL_YEARS, AGE(BIRTHDAY)
FROM STUDENTS
WHERE AGE(BIRTHDAY) > INTERVAL '22 YEARS'; 


-- ■ Показати інформацію про студентів з віком, у вказа-
-- ному діапазоні.
SELECT PIB, BIRTHDAY, EXTRACT(YEAR FROM AGE(BIRTHDAY)) AS FULL_YEARS 
FROM STUDENTS
WHERE AGE(BIRTHDAY) BETWEEN INTERVAL '22 YEARS' AND INTERVAL '23 YEARS';


-- ■ Показати інформацію про студентів із конкретним
-- ім’ям. Наприклад, показати студентів з ім’ям Борис.
SELECT *
FROM STUDENTS
WHERE PIB ILIKE '%артем%';



-- ■ Показати інформацію про студентів, в номері яких
-- є ДВІ 5.

SELECT *
FROM STUDENTS
WHERE TELEPHONE LIKE '%5%5%';

-- ■ Показати електронні адреси студентів, що почина-
-- ються з конкретної літери.
SELECT *
FROM STUDENTS
WHERE EMAIL ILIKE 'S%';

-- Завдання 2
-- Створіть наступні запити для бази даних з оцінками
-- студентів із попереднього практичного завдання:
-- ■ Показати мінімальну середню оцінку по всіх сту-
-- дентах.
SELECT PIB, MIN_SUBJECT_GRADE
FROM STUDENTS;



-- Практичне завдання
-- 1
-- ■ Показати максимальну середню оцінку по всіх сту-
-- дентах.
SELECT PIB, MAX_SUBJECT_GRADE
FROM STUDENTS;

-- ■ Показати статистику міст. Має відображатися назва
-- міста та кількість студентів з цього міста.
SELECT CITY,COUNT(*)
FROM STUDENTS
GROUP BY  CITY;



-- ■ Показати статистику студентів. Має відображатися
-- назва країни та кількість студентів з цієї країни.
SELECT COUNTRY,COUNT(*)
FROM STUDENTS
GROUP BY COUNTRY;



-- ■ Показати кількість студентів з мінімальною середньою
-- оцінкою з математики.
SELECT  COUNT(*)
FROM STUDENTS 
WHERE LOWER(MIN_SUBJECT_NAME) = 'фізика';


-- ■ Показати кількість студентів з максимальною серед-
-- ньою оцінкою з математики.
SELECT COUNT(*)
FROM STUDENTS
WHERE LOWER(MAX_SUBJECT_NAME) = 'програмування';


-- ■ Показати кількість студентів у кожній групі.
SELECT  GROUP_NAME,COUNT(*)
FROM STUDENTS
GROUP BY GROUP_NAME;


-- ■ Показати середню оцінку групи.
SELECT  GROUP_NAME, AVG(AVG_GRADE)
FROM STUDENTS
GROUP BY GROUP_NAME;

-- ПОКАЗАТИ КІЛЬКІСТЬ СТУДЕНТІВ К КОЖНОГО МІСТА ГРУППИ  IT-21
SELECT CITY, COUNT(CITY)---, STRING_AGG(PIB: TEXT)
FROM STUDENTS
WHERE GROUP_NAME = 'ІТ-21'
GROUP BY CITY;


SELECT*
FROM STUDENTS;

--DOSTAT SAMOE BOLSHOY SREDNIYY OZENKY
SELECT MAX(AVG_GRADE)
FROM STUDENTS;

SELECT PIB, AVG_GRADE
FROM STUDENTS
WHERE AVG_GRADE = (
	SELECT MAX(AVG_GRADE) 
	FROM  STUDENTS);
	
-- ТЕ Ж САМЕ ЧЕРЕЗ ПРОМІЖНУ ЗМІННУ
WITH MAXIMUM_AVG AS (
    SELECT MAX(AVG_GRADE) AS COLUMN_AVG
    FROM STUDENTS
 	)
SELECT PIB, AVG_GRADE
FROM STUDENTS , MAXIMUM_AVG
WHERE AVG_GRADE = MAXIMUM_AVG.COLUMN_AVG;



	

